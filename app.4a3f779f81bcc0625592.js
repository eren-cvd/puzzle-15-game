!function(t){function s(s){for(var i,o,r=s[0],a=s[1],l=s[2],d=0,p=[];d<r.length;d++)o=r[d],Object.prototype.hasOwnProperty.call(h,o)&&h[o]&&p.push(h[o][0]),h[o]=0;for(i in a)Object.prototype.hasOwnProperty.call(a,i)&&(t[i]=a[i]);for(c&&c(s);p.length;)p.shift()();return n.push.apply(n,l||[]),e()}function e(){for(var t,s=0;s<n.length;s++){for(var e=n[s],i=!0,r=1;r<e.length;r++){var a=e[r];0!==h[a]&&(i=!1)}i&&(n.splice(s--,1),t=o(o.s=e[0]))}return t}var i={},h={0:0},n=[];function o(s){if(i[s])return i[s].exports;var e=i[s]={i:s,l:!1,exports:{}};return t[s].call(e.exports,e,e.exports,o),e.l=!0,e.exports}o.m=t,o.c=i,o.d=function(t,s,e){o.o(t,s)||Object.defineProperty(t,s,{enumerable:!0,get:e})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,s){if(1&s&&(t=o(t)),8&s)return t;if(4&s&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(o.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&s&&"string"!=typeof t)for(var i in t)o.d(e,i,function(s){return t[s]}.bind(null,i));return e},o.n=function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(s,"a",s),s},o.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)},o.p="";var r=window.webpackJsonp=window.webpackJsonp||[],a=r.push.bind(r);r.push=s,r=r.slice();for(var l=0;l<r.length;l++)s(r[l]);var c=a;n.push([121,1]),e()}({121:function(t,s,e){e(122),t.exports=e(309)},308:function(t,s,e){},309:function(t,s,e){"use strict";e.r(s);e(308);function i(t,s,e){return[...t].sort((t,i)=>t[s]===i[s]?t[e]-i[e]:t[s]-i[s])}class h{constructor({col:t,row:s,width:e,height:i,id:h,border:n,empty:o=!1}={}){this.id=h,this.col=t,this.row=s,this.width=e,this.height=i,this.border=n,this.empty=o,this.x=this.col*this.width,this.y=this.row*this.height,this.vx=this.x,this.vy=this.y,this.originX=this.x,this.originY=this.y,this.speed=20,this.shakeX=35,this.fill="#8AC858",this.bdc="#D8FFBC",this.bdw=3}draw(t){t.fillStyle=this.fill,t.strokeStyle=this.bdc,t.lineWidth=this.bdw,t.save(),t.beginPath(),t.rountRect(this.x,this.y,this.width,this.height,this.border),t.clip(),this.empty||(t.fill(),h.image&&t.drawImage(h.image,this.originX,this.originY,this.width,this.height,this.x,this.y,this.width,this.height),t.stroke()),t.closePath(),t.restore()}shake(){this.x-=this.shakeX,this.y-=this.shakeX}update(){this.vx=Math.floor(this.col*this.width),this.vy=Math.floor(this.row*this.height);const t=(t,s,e)=>t-s<=e&&t-s>=1+~e||t===s;t(this.vx,this.x,this.speed)?this.x=this.vx:this.x+=this.x>this.vx?1+~this.speed:this.speed,t(this.vy,this.y,this.speed)?this.y=this.vy:this.y+=this.y>this.vy?1+~this.speed:this.speed}isClicked(t){return function(t,s){const e=t.x>=s.x&&t.x<=s.x+s.width,i=t.y>=s.y&&t.y<=s.y+s.height;return e&&i}(t,this)}}CanvasRenderingContext2D.prototype.rountRect=function(t,s,e,i,h){const n=2*Math.PI/2,o=2*Math.PI/4;this.arc(h+t,h+s,h,-o,n,!0),this.lineTo(t,s+i-h),this.arc(h+t,i-h+s,h,n,o,!0),this.lineTo(t+e-h,s+i),this.arc(t+e-h,s+i-h,h,o,0,!0),this.lineTo(t+e,s+h),this.arc(t+e-h,s+h,h,0,-o,!0),this.lineTo(t+h,s)};class n{static get path(){return window.location.hash.slice(1)}static get param(){return n.path.split("/")[1]}static navigate(t){window.location.hash=t}}class o extends class{constructor(t="localstorage"){this.key=t}get data(){return JSON.parse(localStorage.getItem(this.key))||{}}set data(t){localStorage.setItem(this.key,JSON.stringify(t))}update(t){this.data=Object.assign(this.data,t)}}{constructor(){super(o.storageKey),this.init()}init(){this.step=this.data.step||0,this.steps=this.data.steps||[],n.navigate("step-"+this.step)}get(){return this.data}clear(){this.step=0,this.steps=[],this.cells=[],this.update({cells:this.cells,steps:this.steps,step:this.step}),n.navigate("step-"+this.step)}setup(t=[]){return this.update({cells:t,steps:this.steps,step:this.step}),t}updateCells(t=[]){t.length&&(t=this.data.cells.map(s=>{const e=t.find(t=>t.id===s.id);return e||s}),this.update({cells:t}))}save(t){this.steps.push(t),this.step+=1,this.update({steps:this.steps,step:this.step}),this.updateCells(t),n.navigate("step-"+this.step)}onStep({step:t,cells:s}){this.step=t,this.update({step:t}),this.updateCells(s),n.navigate("step-"+this.step)}undo(){let t=this.step-1;const s=this.steps[this.step-1];if(s)return t<0&&(t=0),this.onStep({step:t,cells:s}),s[0]}redo(){let t=this.step;const s=this.steps[t];if(s)return t+=1,this.onStep({step:t,cells:s}),s[0]}hasChanges(){return this.step>0}}var r,a,l;l="puzzle-history",(a="storageKey")in(r=o)?Object.defineProperty(r,a,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[a]=l;class c{constructor({$container:t,image:s,background:e}){this.src=s,this.$container=t,this.background=e,this.shuffleTimeout=1e3,this.cols=5,this.rows=5,this.cells=[],this.canvas=null,this.ctx=null,this.history=null,this.emptyCell={},this.destroyed=!1}async init(){await this.loadImage(),h.image=this.image,this.createCanvas(),this.render(),await this.setHistory(),this.bindEvents()}loadImage(){return new Promise(t=>{this.image=new Image,this.image.src=this.src,this.image.addEventListener("load",(function(){t(this)}),!1)})}createCanvas(){const t=this.image.naturalWidth,s=this.image.naturalHeight;this.canvas=document.createElement("canvas"),this.canvas.className="puzzle-canvas",this.canvas.width=t,this.canvas.height=s,this.ctx=this.canvas.getContext("2d"),this.clean(),this.$container.appendChild(this.canvas)}createCells(){this.cells=[];const t=Math.ceil(this.canvas.width/this.cols),s=Math.ceil(this.canvas.height/this.rows);for(let e=0;e<this.cols;e+=1)for(let i=0;i<this.rows;i+=1){const n=new h({col:e,row:i,id:`${i}:${e}`,width:t,height:s,border:5});this.cells.push(n)}this.emptyCell=this.cells[this.cells.length-1],this.emptyCell.empty=!0}loadCells(t){this.cells=t.map(t=>new h(t)),this.emptyCell=this.cells.find(t=>t.empty)}drawCells(){this.cells.forEach(t=>{t.update(),t.draw(this.ctx)})}swapCells(t,s){const e=t.col,i=t.row;[t.col,t.row]=[s.col,s.row],[s.col,s.row]=[e,i]}shuffle(t=this.shuffleTimeout,s=!0){return new Promise(e=>{setTimeout(()=>{this.cells.sort((t,s)=>(this.swapCells(t,s),Math.random()-.5)),s&&(this.cells=i(this.cells,"col","row")),this.history.clear(),e()},t)})}resolve(){this.cells.forEach(t=>{[t.row,t.col]=t.id.split(":")})}moveCells(t,s=!0){t&&(this.swapCells(t,this.emptyCell),s&&this.history.save([t,this.emptyCell]),this.cells=i(this.cells,"col","row"))}async setHistory(){this.history=new o,this.createCells(),await this.shuffle(),this.history.clear(),this.history.setup(this.cells)}undo(){this.undoRedo("undo")}redo(){this.undoRedo("redo")}undoRedo(t="undo"){const s=this.history[t]();if(s){const t=this.cells.find(t=>t.id===s.id);this.moveCells(t,!1)}}clean(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle=this.background,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}render(){this.destroyed||window.requestAnimationFrame(()=>this.render()),this.clean(),this.drawCells()}changeSize(t){t=+t,Number.isInteger(t)&&(this.rows=t,this.cols=t,this.createCells(),this.shuffle())}onKeydown(t){const s=t.key.toLowerCase().replace("arrow","");if(!s)return;const e=this.cells.findIndex(t=>t.empty),i={down:0!==this.emptyCell.row&&e-1,up:this.emptyCell.row!==this.rows-1&&e+1,right:e-this.rows>=0&&e-this.rows,left:e+this.rows<this.cols*this.rows&&e+this.rows}[s];this.moveCells(this.cells[i])}onClick(t){const s=this.canvas.offsetWidth/this.canvas.width,e={x:parseInt((t.pageX-this.canvas.offsetLeft)/s),y:parseInt((t.pageY-this.canvas.offsetTop)/s)},i=this.cells.find(t=>t.isClicked(e));if(i){(h=i,n=this.emptyCell,Math.abs(h.x-n.x)+Math.abs(h.y-n.y))===this.cells[0].width?this.moveCells(i):i.shake()}var h,n}bindEvents(){document.addEventListener("click",t=>this.onClick(t)),document.addEventListener("keydown",t=>this.onKeydown(t))}destroy(){document.removeEventListener("click",t=>this.onClick(t)),document.removeEventListener("keydown",t=>this.onKeydown(t)),this.destroyed=!0}}document.addEventListener("DOMContentLoaded",(function(){const t=document.querySelector(".js-puzzle-container"),s=getComputedStyle(document.documentElement).getPropertyValue("--grey"),e=new c({image:"http://cs.pikabu.ru/images/jobseeker/logo2.png",background:s,$container:t});e.init(),function(){const t=document.querySelector(".js-puzzle-slider"),s=document.querySelectorAll(".js-puzzle-button");t.addEventListener("change",t=>e.changeSize(t.target.value)),s.forEach(t=>t.addEventListener("click",()=>{var s;const{action:i,param:h}=t.dataset;null===(s=e[i])||void 0===s||s.call(e,h)}))}()}))}});