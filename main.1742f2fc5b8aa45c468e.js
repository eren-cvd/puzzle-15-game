!function(t){function e(e){for(var s,r,h=e[0],a=e[1],l=e[2],d=0,u=[];d<h.length;d++)r=h[d],Object.prototype.hasOwnProperty.call(o,r)&&o[r]&&u.push(o[r][0]),o[r]=0;for(s in a)Object.prototype.hasOwnProperty.call(a,s)&&(t[s]=a[s]);for(c&&c(e);u.length;)u.shift()();return n.push.apply(n,l||[]),i()}function i(){for(var t,e=0;e<n.length;e++){for(var i=n[e],s=!0,h=1;h<i.length;h++){var a=i[h];0!==o[a]&&(s=!1)}s&&(n.splice(e--,1),t=r(r.s=i[0]))}return t}var s={},o={0:0},n=[];function r(e){if(s[e])return s[e].exports;var i=s[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=s,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)r.d(i,s,function(e){return t[e]}.bind(null,s));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="";var h=window.webpackJsonp=window.webpackJsonp||[],a=h.push.bind(h);h.push=e,h=h.slice();for(var l=0;l<h.length;l++)e(h[l]);var c=a;n.push([121,1]),i()}({121:function(t,e,i){i(122),i(124),t.exports=i(311)},310:function(t,e,i){},311:function(t,e,i){"use strict";i.r(e);i(310);class s{constructor(t){this.$el="string"==typeof t?document.querySelector(t):t}html(t){return"string"==typeof t?(this.$el.innerHTML=t,this):this.$el.outerHTML.trim()}get data(){return this.$el.dataset}id(t){const{id:e}=this.data;if(t){const[t,i]=e.split(":");return[parseInt(t),parseInt(i)]}return e}attr(t,e){return void 0!==e?(this.$el.setAttribute(t,e),this):this.$el.getAttribute(t)}clear(){return this.html(""),this}parent(){return o(this.$el.parentNode)}coords(){return this.$el.getBoundingClientRect()}replace(t,e){const i=this.find(e);this.$el.replaceChild(t.$el,i.$el)}find(t){return o(this.$el.querySelector(t))}toggleClass(t,e=!0){this.$el.classList[e?"add":"remove"](t)}css(t={},e=""){Object.keys(t).forEach(i=>this.$el.style[i]=t[i]+e)}append(t){return t instanceof s&&(t=t.$el),Element.prototype.append?this.$el.append(t):this.$el.appendChild(t),this}on(t,e){this.$el.addEventListener(t,e)}off(t,e){this.$el.removeEventListener(t,e)}}function o(t){return new s(t)}o.create=(t,e="")=>{const i=document.createElement(t);return e&&i.classList.add(e),o(i)};function n(t,e=null){if(!e)return JSON.parse(localStorage.getItem(t));localStorage.setItem(t,JSON.stringify(e))}class r{constructor(t="puzzle-game-store"){this.key=t,this.state=this.get()}save(t){this.state={...this.state,...t},n(this.key,this.state)}get(){return n(this.key)}clear(){this.state={}}}const h=t=>{return"on"+("string"==typeof(e=t)&&e.split().length?e.charAt(0).toUpperCase()+e.slice(1):"");var e};class a extends class{constructor(t,e=[]){if(!t)throw new Error("DomListener.js: No $root provided");this.$root=t,this.listeners=e}initDOMListeners(){Array.isArray(this.listeners)&&this.listeners.length&&this.listeners.forEach(t=>{const e=h(t);this[e]?(this[e]=this[e].bind(this),this.$root.on(t,this[e])):console.warn(`DomListener.js: Method ${e} is not implemented in ${this.name} component`)})}removeDOMListeners(){this.listeners.forEach(t=>{const e=h(t);this.$root.off(t,this[e])})}}{constructor(t,e={}){super(t,e.listeners),this.router=e.router,this.emitter=e.emitter,this.store=e.store,this.unsubscribers=[]}$emit(t,...e){this.emitter.emit(t,...e)}$on(t,e){const i=this.emitter.listen(t,e);this.unsubscribers.push(i)}init(){this.initDOMListeners()}destroy(){this.removeDOMListeners(),this.unsubscribers.forEach(t=>t())}toHTML(){return""}}class l{constructor(){this.emitted={}}emit(t,...e){return!!Array.isArray(this.emitted[t])&&(this.emitted[t].forEach(t=>{t(...e)}),!0)}listen(t,e){return this.emitted[t]=this.emitted[t]||[],this.emitted[t].push(e),()=>{this.emitted[t]=this.emitted[t].filter(t=>t!=t)}}}class c{static get path(){return window.location.hash.slice(1)}static get param(){return c.path.split("/")[1]}static navigate(t){window.location.hash=t}}var d=class extends a{constructor(t,e){super(o(window),e),this.state=this.getState()||{current:0,executed:[],unexecuted:[]},this.watcheProp=!1}getState(){var t;return null===(t=this.store.get())||void 0===t?void 0:t.history}setState(t,e=!1){e?this.store.save(t):(this.state={...this.state,...t},this.$emit("history:changed",{undo:this.state.executed.length,redo:this.state.unexecuted.length}),this.store.save({history:this.state}))}init(){super.init(),this.$on("history:push",t=>this.push(t)),this.$on("history:undo",()=>this.undo()),this.$on("history:redo",()=>this.redo()),this.$on("history:watch",t=>this.watch(t)),this.$on("history:clear",()=>this.clear()),this.$on("puzzle:shuffle",()=>this.clear())}watch(t){var e;const i=null===(e=Object.keys(t))||void 0===e?void 0:e[0];i&&(this.setState({[i]:t[i]},!0),this.watchedProp=i)}updateWatched(t){if(this.watchedProp){var e;const i=function(t,e,i,s=!1){if(!Array.isArray(t)||!Array.isArray(e))return;return t[s?"filter":"map"](t=>e.find(e=>e[i]===t[i])||t)}(null===(e=this.store.get())||void 0===e?void 0:e[this.watchedProp],t,"id");this.setState({[this.watchedProp]:i},!0)}}push(t){this.state.current++,this.state.executed.push(t),this.setState(),this.updateWatched(t),this.$emit("history:changed")}undo(){const t=this.state.executed.pop();t&&(this.state.current--,this.state.unexecuted.push(t),this.setState(),this.$emit("history:changed",{tiles:t}))}redo(){let t=this.state.unexecuted.pop();t&&(this.state.current++,this.state.executed.push(t),this.setState(),this.$emit("history:changed",{tiles:t}))}clear(){this.state.executed=[],this.state.unexecuted=[],this.state.current=0,this.watchedProp&&(this.state[this.watchedProp]=null),this.setState(),this.$emit("history:changed",{undo:!1,redo:!1})}};class u extends a{constructor(...t){super(...t)}get template(){return JSON.stringify(this.state,null,2)}initState(t={}){this.state={...t}}setState(t){this.state={...this.state,...t},this.$root.html(this.template)}}var m=class extends u{constructor(t,e){super(t,e)}get template(){var t;return`\n        <div class="puzzle-game__loader ${(null===(t=this.state)||void 0===t?void 0:t.loading)?"active":""}">\n            <div class="loader">\n                <div></div>\n                <div></div>\n            </div>\n        </div>\n    `}init(){super.init(),this.setState({loading:!0}),this.$on("image:loaded",()=>{this.setState({loading:!1})}),this.$on("image:change",()=>{this.setState({loading:!0})})}toHTML(){return this.template}};const p={image:"https://picsum.photos/500/500",buttons:["shuffle","resolve","undo","redo","changeImage"],shuffleDelay:1e3,slider:!0,max:10,size:5,min:2},g={38:"move:down",87:"move:down",40:"move:up",83:"move:up",37:"move:right",65:"move:right",39:"move:left",68:"move:left",cmd_90:"history:undo",cmd_89:"history:redo"},f="Good Job! Do you want to play again?",v={shuffle:"Shuffle",resolve:"Resolve",undo:"Undo",redo:"Redo",changeImage:""},y=t=>`\n        <div\n            class="button"\n            data-action='${t.value}'\n            ${t.disabled?"disabled":""}\n        >\n            ${t.title?`<span> ${t.title} </span>`:""}\n            ${t.icon?`<i class="material-icons">${t.icon}</i>`:""}\n        </div>\n    `;class w extends u{constructor(t,e){super(t,{listeners:["click"],...e}),this.config=e.config,this.buttons=this.config.buttons}get template(){return((t={})=>{var e;if(!(null===(e=t.buttons)||void 0===e?void 0:e.length))return" ";const i=[{value:"undo",title:v.undo,disabled:!t.undo},{value:"redo",title:v.redo,disabled:!t.redo},{value:"shuffle",title:v.shuffle,disabled:!1},{value:"resolve",title:v.resolve,disabled:!1},{value:"changeImage",title:v.changeImage,disabled:!1,icon:"wallpaper"}];return t.buttons.map(t=>i.find(e=>e.value===t)).map(y).join("")})(this.state)}init(){super.init(),this.buttons&&(Array.isArray(this.buttons)||(this.buttons=p.buttons),this.setInitialState()),this.$on("history:reset",()=>this.setInitialState())}setInitialState(){var t,e,i,s;const{buttons:o}=this;this.setState({buttons:o,undo:null===(t=this.store.get())||void 0===t||null===(e=t.history)||void 0===e?void 0:e.executed.length,redo:null===(i=this.store.get())||void 0===i||null===(s=i.history)||void 0===s?void 0:s.unexecuted.length}),this.$on("history:changed",(t={})=>{"undo"in t&&this.setState({undo:t.undo}),"redo"in t&&this.setState({redo:t.redo})})}onClick(t){switch(o(t.target).data.action){case"undo":this.$emit("history:undo");break;case"redo":this.$emit("history:redo");break;case"shuffle":this.$emit("puzzle:shuffle",0);break;case"resolve":this.$emit("puzzle:resolve");break;case"changeImage":this.$emit("image:change")}}toHTML(){return this.buttons?this.template:""}}var $,b,z;z="puzzle-game__buttons",(b="className")in($=w)?Object.defineProperty($,b,{value:z,enumerable:!0,configurable:!0,writable:!0}):$[b]=z;var x=w;class k extends a{constructor(t,e){super(t,{listeners:["change"],...e}),this.config=e.config,this.size=this.config.size}init(){super.init()}updateSize(t=this.size){this.size=parseInt(function(t,e,i){if(t<e)return e;return t>i?i:t}(t,this.config.min,this.config.max),10),this.store.save({size:this.size}),this.$emit("size:changed",this.size)}onChange(t){this.updateSize(t.target.value)}toHTML(){return this.config.slider?(t=this.size,e=this.config.min,i=this.config.max,`<input type="range" min="${e}" max="${i}" value="${t}">`):" ";var t,e,i}}!function(t,e,i){e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i}(k,"className","puzzle-game__slider");var S=k;class T{constructor(t=[]){this.tiles=t}get emptyTile(){return this.tiles.find(t=>t.empty)}swap(t){return new Promise(e=>{(null==t?void 0:t.length)||e();const[i,s]=t,o=i.col,n=i.row;[i.col,i.row]=[s.col,s.row],[s.col,s.row]=[o,n],e([i,s])})}shuffle(t=0){this.tiles=function(t){let e=t.length;for(;e--;){const i=Math.floor(Math.random()*(e+1));[t[e],t[i]]=[t[i],t[e]]}return t}(this.tiles).map((t,e,i)=>{const s=i[e+1];return s&&this.swap([t,s]),t}),setTimeout(()=>{this.animate(this.tiles)},t)}resolve(){this.tiles=this.tiles.sort((t,e)=>t.index-e.index).map(t=>([t.col,t.row]=t.el.id(!0),t)),this.animate(this.tiles)}checkResolved(){return!!this.tiles.every(t=>{const[e,i]=t.el.id(!0);return t.col===e&&t.row===i})}animate(t=this.tiles,e){t.forEach(t=>t.update(e))}async moveTiles(t){return this.animate(await this.swap(t)),{resolved:this.checkResolved(),tiles:t}}getEventTiles(t){if(t)return t.target?this.clickTarget(t.target):this.keydownTarget(t)}keydownTarget(t){t=t.toLowerCase().replace("move:","");const{col:e,row:i}=this.emptyTile,s={left:{col:e,row:i-1},right:{col:e,row:i+1},up:{col:e-1,row:i},down:{col:e+1,row:i}},o=this.tiles.find(e=>e.col===s[t].col&&e.row===s[t].row);if(o)return[o,this.emptyTile]}clickTarget(t){let e=!1;const i=o(t).id(),s=this.tiles.find(t=>t.id===i);if(!s)return;const{col:n,row:r}=this.emptyTile;if(s.col===n?e=1===Math.abs(s.row-r):s.row===r&&(e=1===Math.abs(s.col-n)),e)return[s,this.emptyTile];s.shake()}}class H{constructor({size:t,col:e,row:i,width:s,height:o,id:n,index:r,empty:h,boardWidth:a,boardHeight:l}={}){this.size=t,this.index=r,this.empty=h,this.width=s||a/t,this.height=o||l/t,this.col=e||Math.floor(r/t),this.row=i||r%t,this.id=n||`${this.col}:${this.row}`,this.shakeAnimation=600,this.init()}get styles(){return{top:this.col*this.height,left:this.row*this.width,backgroundPositionX:-this.index%this.size*this.width,backgroundPositionY:-Math.floor(this.index/this.size)*this.height,width:this.width,height:this.height}}init(){this.el=o.create("div",H.className),this.el.attr("data-id",this.id),this.empty&&this.el.toggleClass("empty",!0),this.update()}update(t){t&&(this.width=t.width/this.size,this.height=t.height/this.size),this.el.css(this.styles,"px")}shake(){this.el.toggleClass("shaking",!0),setTimeout(()=>{this.el.toggleClass("shaking",!1)},this.shakeAnimation)}}!function(t,e,i){e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i}(H,"className","puzzle-game__tile");const O=(t,e,i)=>{if(!(null==t?void 0:t.src))return"";const s=o.create("style");return s.html(`\n            .puzzle-game__board {\n                width: ${e}px;\n                height: ${i}px;\n            }\n\n            .puzzle-game__board > div {\n                background-image: url(${t.src});\n                background-size: ${e}px ${i}px;\n            }\n        `),s};class L extends a{constructor(t,e){super(t,{listeners:["click"],...e}),this.config=e.config,this.width=0,this.height=0,this.emptyIdx=0,this.tiles=[]}init(){super.init(),this.moveAssistant=new T(this.tiles),this.$on("puzzle:keydown",t=>this.onKeydown(t)),this.$on("puzzle:resolve",()=>this.actionHandler("resolve")),this.$on("puzzle:shuffle",t=>this.actionHandler("shuffle",t)),this.$on("puzzle:resize",t=>this.onResize(t)),this.$on("puzzle:hashchange",t=>this.onHashChanged(t)),this.$on("image:loaded",t=>this.onImageLoaded(t)),this.$on("size:changed",t=>this.createBoard(t,!0)),this.$on("history:changed",t=>this.moveFromHistory(t)),this.moveFromHistory=function(t,e){let i;return function(...s){clearTimeout(i),i=setTimeout(()=>{clearTimeout(i),t.apply(this,s)},e)}}(this.moveFromHistory.bind(this),10)}get coords(){const t=this.$root.parent().coords().width/this.image.width;return{width:this.image.width*t,height:this.image.height*t}}get history(){var t;return(null===(t=this.store.get())||void 0===t?void 0:t.history)||{}}onImageLoaded(t){this.image=t;const{width:e,height:i}=this.coords;this.width=e,this.height=i,this.createBoard()}createBoard(t=this.config.size,e=!1){this.$root.clear(),this.$root.append(O(this.image,this.width,this.height));const i=Object.keys(this.history).length&&!e;var s;(this.tiles=Array(Math.pow(t,2)).fill(0).map((e,i)=>new H({size:t,index:i,boardWidth:this.width,boardHeight:this.height,empty:i===this.emptyIdx})),i)&&this.merge(null===(s=this.store.get())||void 0===s?void 0:s.tiles);this.tiles.forEach(t=>this.$root.append(t.el)),this.moveAssistant.tiles=this.tiles,this.boardCreated(!i)}boardCreated(t=!0){t?this.actionHandler("shuffle",this.config.shuffleDelay):(this.moveAssistant.animate(this.tiles),this.navigate()),this.$emit("history:watch",{tiles:this.tiles})}merge(t){t&&(this.tiles=this.tiles.map(e=>{const i=t.find(t=>t.id===e.id);if(i){const t=e.el;Object.assign(e,i),e.el=t}return e}))}resetHistory(){this.store.clear(),this.$emit("history:reset"),this.$emit("history:watch",{tiles:this.tiles})}actionHandler(t,e){this.resetHistory(),this.navigate(),this.moveAssistant[t](e)}navigate(){this.router.navigate(this.history.current||0)}moveFromHistory({tiles:t}={}){t&&(t=this.tiles.filter(e=>t.find(t=>t.id===e.id)),this.moveAssistant.moveTiles(t),this.navigate())}async moveFromEvent(t){const e=this.moveAssistant.getEventTiles(t);if(e){const{resolved:t,tiles:i}=await this.moveAssistant.moveTiles(e);if(this.$emit("history:push",i),t)return void this.$emit("board:resolved")}}onClick(t){this.moveFromEvent(t)}onKeydown(t){t.includes("move")?this.moveFromEvent(t):this.$emit(t)}onHashChanged(t){}onResize(){const{width:t,height:e}=this.coords,i=O(this.image,t,e);this.$root.replace(i,"style"),this.moveAssistant.animate(this.tiles,{width:t,height:e}),this.resetHistory()}toHTML(){return" "}}!function(t,e,i){e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i}(L,"className","puzzle-game__board");var M=L;const A=[d,m,class extends a{constructor(t,e){super(t,e),this.src=e.config.image,this.width=0,this.height=0}async init(){super.init(),await this.load(this.src),this.$on("image:change",()=>{const t="https://picsum.photos/500/500/?random&t="+Date.now();this.load(t)})}async load(t){await this.loadImage(t).then(e=>{const[i,s]=[e.naturalWidth,e.naturalHeight];this.image=e,this.width=i,this.height=s;const o={src:e.src,width:i,height:s};this.$emit("image:loaded",o),this.store.save({image:t})})}loadImage(t){return new Promise(e=>{const i=new Image;i.src=t,i.addEventListener("load",(function(){e(this)}),!1)})}},x,M,S];new class extends a{constructor(t,e){const i=o(window),s=new l,n=new r;super(i,{router:c,emitter:s,store:n,listeners:["keydown","hashchange","resize"]}),this.$container=o(t),this.config={...p,...e},this.components=A||[],this.emitter=s,this.init()}get root(){const t=o.create("div","puzzle-game"),e={config:this.config,emitter:this.emitter,store:this.store,router:c};return this.components=this.components.map(i=>{const s=o.create("div",i.className),n=new i(s,e);return n.toHTML().length&&(s.html(n.toHTML()),t.append(s)),n}),t}init(){super.init(),this.$container.append(this.root),this.components.forEach(t=>t.init()),this.listen()}listen(){this.onResolve=this.onResolve.bind(this),this.$on("board:resolved",this.onResolve)}onResolve(){confirm(f)&&this.$emit("puzzle:shuffle")}onHashchange(t){const e=t.oldURL.split("#")[1]<t.newURL.split("#")[1];this.$emit("puzzle:hashchange",e)}onResize(t){this.$emit("puzzle:resize")}onKeydown(t){const e=function(t,e){const i=e.altKey;return t[`${`${e.ctrlKey||e.metaKey?"cmd_":""}${i?"alt_":""}`}${e.keyCode}`]}(g,t);e&&this.$emit("puzzle:keydown",e)}destroy(){this.components.forEach(t=>t.destroy())}}("#puzzle",{image:"https://picsum.photos/400?grayscale",slider:!0,size:5})}});